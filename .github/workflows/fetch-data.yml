name: Fetch Boat Race Data

on:
  # 🔁 毎晩 22:00（日本時間 07:00）に自動実行
  schedule:
    - cron: "0 22 * * *"

  # ▶️ GitHub Actions ページから手動実行可能
  workflow_dispatch:

jobs:
  fetch:
    runs-on: ubuntu-latest

    steps:
      - name: 📥 リポジトリを取得
        uses: actions/checkout@v4

      - name: 🐍 Python をセットアップ
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: 📦 依存パッケージをインストール
        run: |
          pip install requests
          pip install beautifulsoup4
          pip install lxml
          pip install pandas

      - name: 🚀 データ取得を実行
        run: |
          echo "📅 60日分のレースデータを取得しています..."
          python fetch_data.py

      - name: 💾 データ更新をコミット＆プッシュ
        run: |
          git config --local user.email "actions@github.com"
          git config --local user.name "github-actions[bot]"
          git add data.json history.json features.csv || true
          git commit -m "🏁 自動更新: 最新レースデータ取得" || echo "No changes to commit"
          git push

      - name: ✅ 完了ログ
        run: echo "🎉 データ取得と更新が完了しました！"
