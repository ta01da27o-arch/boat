name: Fetch Boat Race Data (24å ´å¯¾å¿œç‰ˆ)

on:
  schedule:
    # æ¯æ—¥23:00(JST) ã«è‡ªå‹•å®Ÿè¡Œï¼ˆUTC 14:00ï¼‰
    - cron: "0 14 * * *"
  workflow_dispatch:  # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  update:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¦ ãƒªãƒã‚¸ãƒˆãƒªå–å¾—
        uses: actions/checkout@v4

      - name: ğŸ Pythonã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: ğŸ”§ ä¾å­˜ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
        run: |
          python -m pip install --upgrade pip
          pip install requests

      - name: ğŸš€ è‡ªå‹•æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹
        run: |
          echo "ğŸš€ Render è‡ªå‹•æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹"
          python fetch_data.py

      - name: ğŸ§© å‡ºåŠ›ç¢ºèª
        run: |
          echo "ğŸ§© data.json:"
          cat data/data.json | head -n 40 || true
          echo "ğŸ§  history.json:"
          cat data/history.json | head -n 40 || true

      - name: ğŸª„ Git è¨­å®š
        run: |
          git config --local user.name "github-actions[bot]"
          git config --local user.email "github-actions[bot]@users.noreply.github.com"

      - name: ğŸ“¤ å¤‰æ›´ã‚’GitHubã¸åæ˜ 
        run: |
          git add data/*.json || true
          if git diff --cached --quiet; then
            echo "âœ… å¤‰æ›´ãªã—ã€‚ã‚³ãƒŸãƒƒãƒˆã‚’ã‚¹ã‚­ãƒƒãƒ—ã€‚"
          else
            git commit -m "ğŸ” Auto Update: $(date '+%Y-%m-%d %H:%M:%S')"
            git push origin main
            echo "ğŸ“¡ GitHubã¸è‡ªå‹•Pushå®Œäº†"
          fi