name: Fetch Boat Race Data

on:
  schedule:
    - cron: "0 23 * * *"  # æ¯æ—¥ æ—¥æœ¬æ™‚é–“8:00é ƒã«å®Ÿè¡Œ
  workflow_dispatch:      # æ‰‹å‹•å®Ÿè¡Œã‚‚å¯èƒ½

jobs:
  fetch:
    runs-on: ubuntu-latest

    steps:
      # ãƒªãƒã‚¸ãƒˆãƒªã‚’ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆï¼ˆå±¥æ­´ã‚‚å«ã‚ã¦ï¼‰
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          fetch-depth: 0

      # Python ç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.x'

      # å¿…è¦ãªãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
      - name: Install dependencies
        run: |
          pip install requests beautifulsoup4 lxml pandas || true

      # ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’å®Ÿè¡Œ
      - name: Run fetch_data.py
        run: |
          echo "ğŸš€ GitHub Actions è‡ªå‹•æ›´æ–°ã‚¹ã‚¯ãƒªãƒ—ãƒˆé–‹å§‹"
          python fetch_data.py

      # data.json ã«å¤‰æ›´ãŒã‚ã‚Œã°ã‚³ãƒŸãƒƒãƒˆï¼†ãƒ—ãƒƒã‚·ãƒ¥
      - name: Commit and push if changed
        run: |
          git config --local user.email "github-actions[bot]@users.noreply.github.com"
          git config --local user.name "github-actions[bot]"
          git add -A
          git commit -m "Auto update ($(date '+%Y-%m-%d'))" || exit 0

          echo "ğŸ”„ æœ€æ–°çŠ¶æ…‹ã‚’å–å¾—ã—ã¦å†ãƒ™ãƒ¼ã‚¹åŒ–ï¼ˆrebaseï¼‰ä¸­..."
          git pull --rebase origin main || true

          echo "â¬†ï¸ æ›´æ–°ãƒ‡ãƒ¼ã‚¿ã‚’ãƒ—ãƒƒã‚·ãƒ¥ä¸­..."
          git push origin main || echo "âš ï¸ pushã«å¤±æ•—ã—ã¾ã—ãŸã€‚å†å®Ÿè¡Œã‚’å¾…ã¡ã¾ã™ã€‚"

      # å®Ÿè¡Œå®Œäº†ãƒ­ã‚°
      - name: Done
        run: echo "ğŸ¯ fetch-data.yml å®Œäº†"